<!DOCTYPE html>

<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ïö∞Î¶¨Ïßë Ï∞® Ïñ¥ÎîîÏûàÏßÄ? üöó</title>
    <meta name="theme-color" content="#2563eb">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Ïö∞Î¶¨Ïßë Ï∞® Ïñ¥ÎîîÏûàÏßÄ?">
    <link rel="apple-touch-icon" sizes="192x192" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'%3E%3Crect width='192' height='192' fill='%232563eb'/%3E%3Ctext x='96' y='130' font-size='80' fill='white' text-anchor='middle'%3Eüöó%3C/text%3E%3C/svg%3E">

```
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        color: #333;
        -webkit-user-select: none;
        -webkit-touch-callout: none;
    }

    .container {
        max-width: 414px;
        margin: 0 auto;
        background: #f9fafb;
        min-height: 100vh;
        overflow-x: hidden;
    }

    .header {
        background: linear-gradient(135deg, #2563eb, #3b82f6);
        color: white;
        padding: 20px;
        text-align: center;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .header h1 {
        font-size: 1.5rem;
        margin-bottom: 5px;
    }

    .header p {
        opacity: 0.9;
        font-size: 0.9rem;
    }

    .connection-status {
        padding: 10px 20px;
        font-size: 0.8rem;
        text-align: center;
    }

    .status-connected {
        background: #10b981;
        color: white;
    }

    .status-local {
        background: #f59e0b;
        color: white;
    }

    .main-content {
        padding: 20px;
    }

    .login-section {
        background: white;
        border-radius: 12px;
        padding: 30px 20px;
        margin-bottom: 20px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        text-align: center;
    }

    .login-section h2 {
        margin-bottom: 20px;
        color: #1f2937;
    }

    .login-tabs {
        display: flex;
        margin-bottom: 20px;
        background: #f3f4f6;
        border-radius: 8px;
        padding: 4px;
    }

    .login-tab {
        flex: 1;
        padding: 10px;
        background: transparent;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.2s;
    }

    .login-tab.active {
        background: white;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        font-weight: bold;
    }

    .car-list {
        margin-bottom: 30px;
    }

    .car-card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 15px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        transition: transform 0.2s;
    }

    .car-card:hover {
        transform: translateY(-2px);
    }

    .car-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
    }

    .car-name {
        font-size: 1.2rem;
        font-weight: bold;
        color: #1f2937;
    }

    .car-status {
        font-size: 0.8rem;
        padding: 4px 8px;
        border-radius: 20px;
        background: #ecfdf5;
        color: #065f46;
    }

    .parking-info {
        background: #f3f4f6;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 15px;
    }

    .location-text {
        font-size: 1.1rem;
        color: #374151;
        margin-bottom: 5px;
    }

    .update-time {
        font-size: 0.8rem;
        color: #6b7280;
    }

    .updated-by {
        font-size: 0.8rem;
        color: #9ca3af;
        font-style: italic;
    }

    .no-location {
        color: #9ca3af;
        font-style: italic;
    }

    .btn-group {
        display: flex;
        gap: 10px;
    }

    .btn {
        flex: 1;
        padding: 12px;
        border: none;
        border-radius: 8px;
        font-size: 0.9rem;
        cursor: pointer;
        transition: all 0.2s;
    }

    .btn-primary {
        background: #2563eb;
        color: white;
    }

    .btn-primary:hover {
        background: #1d4ed8;
    }

    .btn-secondary {
        background: #f3f4f6;
        color: #374151;
    }

    .btn-secondary:hover {
        background: #e5e7eb;
    }

    .add-car-btn {
        width: 100%;
        padding: 15px;
        background: #10b981;
        color: white;
        border: none;
        border-radius: 12px;
        font-size: 1rem;
        font-weight: bold;
        cursor: pointer;
        margin-bottom: 20px;
    }

    .add-car-btn:hover {
        background: #059669;
    }

    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        z-index: 1000;
    }

    .modal-content {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        padding: 30px;
        border-radius: 12px;
        width: 90%;
        max-width: 400px;
    }

    .modal h2 {
        margin-bottom: 20px;
        text-align: center;
        color: #1f2937;
    }

    .form-group {
        margin-bottom: 20px;
    }

    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: bold;
        color: #374151;
    }

    .form-group input,
    .form-group select {
        width: 100%;
        padding: 12px;
        border: 1px solid #d1d5db;
        border-radius: 8px;
        font-size: 1rem;
    }

    .form-group input:focus,
    .form-group select:focus {
        outline: none;
        border-color: #2563eb;
        box-shadow: 0 0 0 3px rgba(37,99,235,0.1);
    }

    .modal-buttons {
        display: flex;
        gap: 10px;
        margin-top: 20px;
    }

    .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 20px;
        background: #10b981;
        color: white;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        transform: translateX(300px);
        transition: transform 0.3s;
        z-index: 1001;
    }

    .notification.show {
        transform: translateX(0);
    }

    .notification.error {
        background: #ef4444;
    }

    .settings {
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid #e5e7eb;
    }

    .settings h3 {
        color: #374151;
        margin-bottom: 15px;
    }

    .setting-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 0;
        border-bottom: 1px solid #f3f4f6;
    }

    .toggle {
        position: relative;
        width: 50px;
        height: 24px;
        background: #d1d5db;
        border-radius: 24px;
        cursor: pointer;
        transition: background 0.3s;
    }

    .toggle.active {
        background: #10b981;
    }

    .toggle::after {
        content: '';
        position: absolute;
        top: 2px;
        left: 2px;
        width: 20px;
        height: 20px;
        background: white;
        border-radius: 50%;
        transition: left 0.3s;
    }

    .toggle.active::after {
        left: 28px;
    }

    .share-info {
        background: #eff6ff;
        border: 1px solid #bfdbfe;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 20px;
        text-align: center;
    }

    .share-code {
        font-family: monospace;
        font-size: 1.2rem;
        font-weight: bold;
        color: #1d4ed8;
        background: white;
        padding: 8px 12px;
        border-radius: 6px;
        margin: 8px 0;
        display: inline-block;
    }

    .logout-section {
        text-align: center;
        margin-top: 20px;
    }

    .btn-logout {
        background: #6b7280;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
    }

    .update-banner {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        background: #059669;
        color: white;
        padding: 12px 20px;
        text-align: center;
        z-index: 10001;
        font-size: 0.9rem;
    }

    .refresh-btn {
        background: white;
        color: #059669;
        border: none;
        padding: 4px 12px;
        border-radius: 4px;
        margin-left: 10px;
        font-weight: bold;
        cursor: pointer;
    }
</style>
```

</head>
<body>
    <div class="container">
        <header class="header">
            <h1>üöó Ïö∞Î¶¨Ïßë Ï∞® Ïñ¥ÎîîÏûàÏßÄ?</h1>
            <p>Ï£ºÏ∞® ÏúÑÏπòÎ•º Í∞ÄÏ°±Í≥º Ïã§ÏãúÍ∞Ñ Í≥µÏú†ÌïòÏÑ∏Ïöî</p>
        </header>

```
    <div class="connection-status" id="connectionStatus">
        üîå Ïó∞Í≤∞ ÏÉÅÌÉú ÌôïÏù∏ Ï§ë...
    </div>

    <main class="main-content">
        <!-- Î°úÍ∑∏Ïù∏/ÌöåÏõêÍ∞ÄÏûÖ ÏÑπÏÖò -->
        <div class="login-section" id="loginSection">
            <h2>üîë Í∑∏Î£π Ï†ëÏÜç</h2>
            
            <div class="login-tabs">
                <button class="login-tab active" onclick="switchTab('join')">Ï∞∏Ïó¨ÌïòÍ∏∞</button>
                <button class="login-tab" onclick="switchTab('create')">ÏÉàÎ°ú ÎßåÎì§Í∏∞</button>
            </div>

            <!-- Ï∞∏Ïó¨ÌïòÍ∏∞ Ìèº -->
            <div id="joinForm">
                <div class="form-group">
                    <label for="joinCode">Í≥µÏú† ÏΩîÎìú</label>
                    <input type="text" id="joinCode" placeholder="Í≥µÏú† ÏΩîÎìúÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî" style="text-transform: uppercase;">
                </div>
                <div class="form-group">
                    <label for="joinPassword">ÎπÑÎ∞ÄÎ≤àÌò∏</label>
                    <input type="password" id="joinPassword" placeholder="ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî">
                </div>
                <div class="form-group">
                    <label for="joinNickname">ÎÇ¥ Ïù¥Î¶Ñ</label>
                    <input type="text" id="joinNickname" placeholder="Í∞ÄÏ°±Îì§Ïù¥ ÏïåÏïÑÎ≥º Ïù¥Î¶Ñ" maxlength="10">
                </div>
                <button class="btn btn-primary" style="width: 100%; margin-top: 10px;" onclick="joinGroup()">
                    Í∑∏Î£π Ï∞∏Ïó¨ÌïòÍ∏∞
                </button>
            </div>

            <!-- ÏÉàÎ°ú ÎßåÎì§Í∏∞ Ìèº -->
            <div id="createForm" style="display: none;">
                <div class="form-group">
                    <label for="createPassword">ÎπÑÎ∞ÄÎ≤àÌò∏ ÏÑ§Ï†ï</label>
                    <input type="password" id="createPassword" placeholder="Í∑∏Î£π ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏÑ§Ï†ïÌïòÏÑ∏Ïöî">
                </div>
                <div class="form-group">
                    <label for="createNickname">ÎÇ¥ Ïù¥Î¶Ñ</label>
                    <input type="text" id="createNickname" placeholder="Í∞ÄÏ°±Îì§Ïù¥ ÏïåÏïÑÎ≥º Ïù¥Î¶Ñ" maxlength="10">
                </div>
                <button class="btn btn-primary" style="width: 100%; margin-top: 10px;" onclick="createGroup()">
                    ÏÉà Í∑∏Î£π ÎßåÎì§Í∏∞
                </button>
            </div>
        </div>

        <!-- Î©îÏù∏ Ïï± ÏÑπÏÖò -->
        <div class="app-section" id="appSection" style="display: none;">
            <!-- Í≥µÏú† Ï†ïÎ≥¥ -->
            <div class="share-info" id="shareInfo">
                <div>üîó Í∑∏Î£π Í≥µÏú† Ï†ïÎ≥¥</div>
                <div class="share-code" id="displayShareCode">LOADING...</div>
                <div style="font-size: 0.9rem; color: #6b7280;">Ïù¥ ÏΩîÎìúÏôÄ ÎπÑÎ∞ÄÎ≤àÌò∏Î•º Í∞ÄÏ°±ÏóêÍ≤å Í≥µÏú†ÌïòÏÑ∏Ïöî</div>
            </div>

            <button class="add-car-btn" onclick="showAddCarModal()">
                ‚ûï ÏÉà Ï∞®Îüâ Ï∂îÍ∞Ä
            </button>

            <div class="car-list" id="carList">
                <!-- Ï∞®Îüâ Ïπ¥ÎìúÎì§Ïù¥ Ïó¨Í∏∞Ïóê ÎèôÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎê©ÎãàÎã§ -->
            </div>

            <div class="settings">
                <h3>‚öôÔ∏è ÏÑ§Ï†ï</h3>
                <div class="setting-item">
                    <div>
                        <div style="font-weight: bold;">Ïä§ÎßàÌä∏ ÏïåÎ¶º üì±</div>
                        <div style="font-size: 0.8rem; color: #6b7280;">Î∞§ 9ÏãúÏóê Ï£ºÏ∞® ÏúÑÏπò ÏóÖÎç∞Ïù¥Ìä∏ ÏïåÎ¶º</div>
                    </div>
                    <div class="toggle" id="notificationToggle" onclick="toggleNotification()"></div>
                </div>
                <div class="setting-item">
                    <div>
                        <div style="font-weight: bold;">Í∞ïÏ†ú ÏÉàÎ°úÍ≥†Ïπ®</div>
                        <div style="font-size: 0.8rem; color: #6b7280;">
                            <button onclick="forceRefresh()" style="
                                background: #10b981; color: white; border: none; 
                                padding: 4px 8px; border-radius: 4px; font-size: 0.7rem; 
                                margin-top: 4px; cursor: pointer;
                            ">Îç∞Ïù¥ÌÑ∞ ÏÉàÎ°úÍ≥†Ïπ®</button>
                            <button onclick="clearCache()" style="
                                background: #ef4444; color: white; border: none; 
                                padding: 4px 8px; border-radius: 4px; font-size: 0.7rem; 
                                margin-top: 4px; margin-left: 4px; cursor: pointer;
                            ">Ï∫êÏãú ÏÇ≠Ï†ú</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="logout-section">
                <button class="btn-logout" onclick="logout()">Í∑∏Î£π ÎÇòÍ∞ÄÍ∏∞</button>
            </div>
        </div>
    </main>
</div>

<!-- Ï∞®Îüâ Ï∂îÍ∞Ä Î™®Îã¨ -->
<div class="modal" id="addCarModal">
    <div class="modal-content">
        <h2>ÏÉà Ï∞®Îüâ Ï∂îÍ∞Ä</h2>
        <div class="form-group">
            <label for="carName">Ï∞®Îüâ Ïù¥Î¶Ñ (Î™®Îç∏Î™Ö ÎòêÎäî Ïï†Ïπ≠)</label>
            <input type="text" id="carName" placeholder="Ïòà: ÏÜåÎÇòÌÉÄ, Ïö∞Î¶¨Ïßë Ï∞®" />
        </div>
        <div class="modal-buttons">
            <button class="btn btn-secondary" onclick="hideAddCarModal()">Ï∑®ÏÜå</button>
            <button class="btn btn-primary" onclick="addCar()">Ï∂îÍ∞Ä</button>
        </div>
    </div>
</div>

<!-- Ï£ºÏ∞® ÏúÑÏπò ÏóÖÎç∞Ïù¥Ìä∏ Î™®Îã¨ -->
<div class="modal" id="updateLocationModal">
    <div class="modal-content">
        <h2 id="updateModalTitle">Ï£ºÏ∞® ÏúÑÏπò ÏóÖÎç∞Ïù¥Ìä∏</h2>
        <div class="form-group">
            <label for="floor">Ï£ºÏ∞® Ï∏µ</label>
            <select id="floor">
                <option value="">Ï∏µ ÏÑ†ÌÉù</option>
                <option value="B5">ÏßÄÌïò 5Ï∏µ</option>
                <option value="B4">ÏßÄÌïò 4Ï∏µ</option>
                <option value="B3">ÏßÄÌïò 3Ï∏µ</option>
            </select>
        </div>
        <div class="form-group">
            <label for="section">Íµ¨Ïó≠/ÏúÑÏπò</label>
            <input type="text" id="section" placeholder="Ïòà: A-15, Ïó¨ÏÑ±Ï£ºÏ∞®Ïû•, Ï†ÑÍ∏∞Ï∞®Íµ¨Ïó≠, Ï∂úÍµ¨ Ïïû" />
        </div>
        <div class="modal-buttons">
            <button class="btn btn-secondary" onclick="hideUpdateModal()">Ï∑®ÏÜå</button>
            <button class="btn btn-primary" onclick="updateLocation()">ÏóÖÎç∞Ïù¥Ìä∏</button>
        </div>
    </div>
</div>

<!-- ÏïåÎ¶º -->
<div class="notification" id="notification"></div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
    // Firebase ÏÑ§Ï†ï
    const firebaseConfig = {
        apiKey: "AIzaSyDVoA4aRmhrwcDeU4qT9ZWBvLGdecYEwk4",
        authDomain: "car-parking-app-8aec7.firebaseapp.com",
        databaseURL: "https://car-parking-app-8aec7-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "car-parking-app-8aec7",
        storageBucket: "car-parking-app-8aec7.firebasestorage.app",
        messagingSenderId: "439284952071",
        appId: "1:439284952071:web:f101098f0c3ccf700f4ea2"
    };

    // Ï†ÑÏó≠ Î≥ÄÏàò
    let database;
    let isOnline = false;
    let cars = [];
    let currentCarId = null;
    let notificationEnabled = false;
    let currentGroup = null;
    let userNickname = '';
    let lastDataUpdate = 0;
    const STORAGE_KEY = 'carParkingApp';

    // Firebase Ï¥àÍ∏∞Ìôî
    function initFirebase() {
        console.log('üîÑ Firebase Ï¥àÍ∏∞Ìôî ÏãúÎèÑ...');
        
        if (typeof firebase === 'undefined') {
            console.error('‚ùå Firebase SDK Î°úÎìú Ïã§Ìå®');
            isOnline = false;
            updateConnectionStatus('offline');
            return;
        }
        
        try {
            firebase.initializeApp(firebaseConfig);
            database = firebase.database();
            
            database.ref('.info/connected').on('value', (snapshot) => {
                if (snapshot.val() === true) {
                    console.log('üü¢ Firebase Ïã§ÏãúÍ∞Ñ Ïó∞Í≤∞Îê®');
                    isOnline = true;
                    updateConnectionStatus('online');
                    if (currentGroup) {
                        loadGroupData();
                    }
                } else {
                    console.log('üü° Firebase Ïó∞Í≤∞ ÎÅäÍπÄ');
                    isOnline = false;
                    updateConnectionStatus('offline');
                }
            });
            
            console.log('‚úÖ Firebase Ïó∞Í≤∞ ÏÑ±Í≥µ!');
            
        } catch (error) {
            console.error('‚ùå Firebase Ïó∞Í≤∞ Ïã§Ìå®:', error);
            isOnline = false;
            updateConnectionStatus('offline');
        }
    }

    // Ï¥àÍ∏∞Ìôî
    document.addEventListener('DOMContentLoaded', function() {
        setTimeout(initFirebase, 500);
        checkExistingSession();
        scheduleNotifications();
        
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden && currentGroup && isOnline) {
                console.log('üì± Ïï±Ïù¥ Ìè¨Ïª§Ïä§Îê® - Îç∞Ïù¥ÌÑ∞ ÏÉàÎ°úÍ≥†Ïπ®');
                loadGroupData();
            }
        });
    });

    // Í∞ïÏ†ú ÏÉàÎ°úÍ≥†Ïπ®
    function forceRefresh() {
        showNotification('ÏÉàÎ°úÍ≥†Ïπ® Ï§ë...');
        setTimeout(() => {
            window.location.reload(true);
        }, 500);
    }

    // Ï∫êÏãú ÏôÑÏ†Ñ ÏÇ≠Ï†ú
    async function clearCache() {
        if (confirm('Î™®Îì† Ï∫êÏãúÎ•º ÏÇ≠Ï†úÌïòÍ≥† ÏÉàÎ°úÍ≥†Ïπ®ÌïòÏãúÍ≤†Ïñ¥Ïöî?')) {
            try {
                const userData = localStorage.getItem(STORAGE_KEY);
                localStorage.clear();
                if (userData) {
                    localStorage.setItem(STORAGE_KEY, userData);
                }
                
                showNotification('Ï∫êÏãúÍ∞Ä ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§. ÏÉàÎ°úÍ≥†Ïπ®Ìï©ÎãàÎã§...');
                setTimeout(() => {
                    window.location.reload(true);
                }, 1000);
                
            } catch (error) {
                console.error('Ï∫êÏãú ÏÇ≠Ï†ú Ïã§Ìå®:', error);
                showNotification('Ï∫êÏãú ÏÇ≠Ï†ú Ïã§Ìå®. ÏàòÎèôÏúºÎ°ú ÏÉàÎ°úÍ≥†Ïπ®Ìï¥Ï£ºÏÑ∏Ïöî.', 'error');
            }
        }
    }

    // Í∏∞Ï°¥ ÏÑ∏ÏÖò ÌôïÏù∏
    function checkExistingSession() {
        const data = localStorage.getItem(STORAGE_KEY);
        if (data) {
            const parsed = JSON.parse(data);
            if (parsed.currentGroup && parsed.userNickname) {
                currentGroup = parsed.currentGroup;
                userNickname = parsed.userNickname;
                notificationEnabled = parsed.notificationEnabled || false;
                document.getElementById('notificationToggle').classList.toggle('active', notificationEnabled);
                
                showAppSection();
                
                if (isOnline) {
                    loadGroupData();
                } else {
                    cars = parsed.cars || [];
                    renderCarList();
                }
                return;
            }
        }
        showLoginSection();
    }

    // Ïó∞Í≤∞ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
    function updateConnectionStatus(status) {
        const statusElement = document.getElementById('connectionStatus');
        if (status === 'online') {
            statusElement.innerHTML = 'üü¢ Ïã§ÏãúÍ∞Ñ ÎèôÍ∏∞Ìôî ÌôúÏÑ±Ìôî';
            statusElement.className = 'connection-status status-connected';
        } else {
            statusElement.innerHTML = 'üü° Î°úÏª¨ Î™®Îìú (ÎèôÍ∏∞Ìôî Î∂àÍ∞Ä)';
            statusElement.className = 'connection-status status-local';
        }
    }

    // ÌÉ≠ Ï†ÑÌôò
    function switchTab(tab) {
        const joinTab = document.querySelector('.login-tab:first-child');
        const createTab = document.querySelector('.login-tab:last-child');
        const joinForm = document.getElementById('joinForm');
        const createForm = document.getElementById('createForm');

        if (tab === 'join') {
            joinTab.classList.add('active');
            createTab.classList.remove('active');
            joinForm.style.display = 'block';
            createForm.style.display = 'none';
        } else {
            joinTab.classList.remove('active');
            createTab.classList.add('active');
            joinForm.style.display = 'none';
            createForm.style.display = 'block';
        }
    }

    // ÏÉà Í∑∏Î£π ÎßåÎì§Í∏∞
    async function createGroup() {
        const password = document.getElementById('createPassword').value.trim();
        const nickname = document.getElementById('createNickname').value.trim();

        if (!password || !nickname) {
            showNotification('ÎπÑÎ∞ÄÎ≤àÌò∏ÏôÄ Ïù¥Î¶ÑÏùÑ Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî', 'error');
            return;
        }

        const groupCode = generateGroupCode();
        currentGroup = { code: groupCode, password: password };
        userNickname = nickname;

        if (isOnline) {
            try {
                await database.ref(`groups/${groupCode}`).set({
                    password: password,
                    createdAt: Date.now(),
                    cars: {},
                    members: {
                        [generateUserId()]: {
                            nickname: nickname,
                            joinedAt: Date.now()
                        }
                    }
                });
                showNotification('ÏÉà Í∑∏Î£πÏù¥ ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§!');
            } catch (error) {
                showNotification('Í∑∏Î£π ÏÉùÏÑ± Ïã§Ìå®: ' + error.message, 'error');
                return;
            }
        }

        saveLocalData();
        showAppSection();
    }

    // Í∑∏Î£π Ï∞∏Ïó¨ÌïòÍ∏∞
    async function joinGroup() {
        const code = document.getElementById('joinCode').value.trim().toUpperCase();
        const password = document.getElementById('joinPassword').value.trim();
        const nickname = document.getElementById('joinNickname').value.trim();

        if (!code || !password || !nickname) {
            showNotification('Î™®Îì† ÌïÑÎìúÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî', 'error');
            return;
        }

        if (isOnline) {
            try {
                const groupSnapshot = await database.ref(`groups/${code}`).once('value');
                const groupData = groupSnapshot.val();

                if (!groupData) {
                    showNotification('Ï°¥Ïû¨ÌïòÏßÄ ÏïäÎäî Í∑∏Î£π ÏΩîÎìúÏûÖÎãàÎã§', 'error');
                    return;
                }

                if (groupData.password !== password) {
                    showNotification('ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÌãÄÎ†∏ÏäµÎãàÎã§', 'error');
                    return;
                }

                const userId = generateUserId();
                await database.ref(`groups/${code}/members/${userId}`).set({
                    nickname: nickname,
                    joinedAt: Date.now()
                });

                showNotification(`${code} Í∑∏Î£πÏóê Ï∞∏Ïó¨ÌñàÏäµÎãàÎã§!`);
            } catch (error) {
                showNotification('Í∑∏Î£π Ï∞∏Ïó¨ Ïã§Ìå®: ' + error.message, 'error');
                return;
            }
        } else {
            showNotification('Ïò§ÌîÑÎùºÏù∏ Î™®ÎìúÎ°ú Í∑∏Î£π Ï†ëÏÜç', 'error');
        }

        currentGroup = { code: code, password: password };
        userNickname = nickname;
        saveLocalData();
        showAppSection();
        
        if (isOnline) {
            loadGroupData();
        }
    }

    // Ïï± ÏÑπÏÖò ÌëúÏãú
    function showAppSection() {
        document.getElementById('loginSection').style.display = 'none';
        document.getElementById('appSection').style.display = 'block';
        document.getElementById('displayShareCode').textContent = currentGroup.code;
    }

    // Î°úÍ∑∏Ïù∏ ÏÑπÏÖò ÌëúÏãú
    function showLoginSection() {
        document.getElementById('loginSection').style.display = 'block';
        document.getElementById('appSection').style.display = 'none';
    }

    // Î°úÍ∑∏ÏïÑÏõÉ
    function logout() {
        if (confirm('Ï†ïÎßê Í∑∏Î£πÏóêÏÑú ÎÇòÍ∞ÄÏãúÍ≤†Ïñ¥Ïöî?')) {
            currentGroup = null;
            userNickname = '';
            cars = [];
            localStorage.removeItem(STORAGE_KEY);
            showLoginSection();
            showNotification('Í∑∏Î£πÏóêÏÑú ÎÇòÍ∞îÏäµÎãàÎã§');
        }
    }

    // Í∑∏Î£π Îç∞Ïù¥ÌÑ∞ Î°úÎìú
    function loadGroupData() {
        if (!isOnline || !currentGroup) return;

        const now = Date.now();
        if (now - lastDataUpdate < 1000) {
            console.log('‚è≥ Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ï§ëÎ≥µ Ìò∏Ï∂ú Î∞©ÏßÄ');
            return;
        }
        lastDataUpdate = now;

        console.log('üì° FirebaseÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ï§ë...');
        
        database.ref(`groups/${currentGroup.code}/cars`).off();
        database.ref(`groups/${currentGroup.code}/cars`).on('value', (snapshot) => {
            const data = snapshot.val();
            cars = data ? Object.keys(data).map(key => ({
                id: key,
                ...data[key]
            })) : [];
            
            console.log('üìÑ Îç∞Ïù¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏:', cars.length, 'Í∞ú Ï∞®Îüâ');
            renderCarList();
            saveLocalData();
        });
    }

    // Î°úÏª¨ Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
    function saveLocalData() {
        const data = {
            currentGroup: currentGroup,
            userNickname: userNickname,
            notificationEnabled: notificationEnabled,
            cars: cars,
            lastSaved: Date.now()
        };
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }

    // Ïò®ÎùºÏù∏ Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
    async function saveOnlineData() {
        if (!isOnline || !currentGroup) {
            saveLocalData();
            return;
        }

        try {
            const carsData = {};
            cars.forEach(car => {
                carsData[car.id] = {
                    name: car.name,
                    location: car.location,
                    lastUpdated: car.lastUpdated,
                    updatedBy: car.updatedBy
                };
            });

            await database.ref(`groups/${currentGroup.code}/cars`).set(carsData);
            console.log('üíæ Firebase Ï†ÄÏû• ÏôÑÎ£å');
            saveLocalData();
        } catch (error) {
            console.error('‚ùå Firebase Ï†ÄÏû• Ïã§Ìå®:', error);
            showNotification('ÎèôÍ∏∞Ìôî Ïã§Ìå®: ' + error.message, 'error');
            saveLocalData();
        }
    }

    // Ï∞®Îüâ Î™©Î°ù Î†åÎçîÎßÅ
    function renderCarList() {
        const carList = document.getElementById('carList');
        carList.innerHTML = '';

        if (cars.length === 0) {
            carList.innerHTML = `
                <div style="text-align: center; padding: 40px; color: #6b7280;">
                    <div style="font-size: 3rem; margin-bottom: 10px;">üöó</div>
                    <div>ÏïÑÏßÅ Îì±Î°ùÎêú Ï∞®ÎüâÏù¥ ÏóÜÏñ¥Ïöî</div>
                    <div style="font-size: 0.9rem; margin-top: 5px;">ÏÉà Ï∞®Îüâ Ï∂îÍ∞Ä Î≤ÑÌäºÏùÑ ÎàåÎü¨Ï£ºÏÑ∏Ïöî</div>
                </div>
            `;
            return;
        }

        cars.forEach(car => {
            const timeAgo = car.lastUpdated ? getTimeAgo(car.lastUpdated) : null;
            
            const carCard = document.createElement('div');
            carCard.className = 'car-card';
            carCard.innerHTML = `
                <div class="car-header">
                    <div class="car-name">${car.name}</div>
                    <div class="car-status">${car.location ? 'ÏúÑÏπò ÏûàÏùå' : 'ÏúÑÏπò ÏóÜÏùå'}</div>
                </div>
                <div class="parking-info">
                    ${car.location ? 
                        `<div class="location-text">${car.location}</div>` + 
                        (timeAgo ? `<div class="update-time">${timeAgo} ÏóÖÎç∞Ïù¥Ìä∏</div>` : '') +
                        (car.updatedBy ? `<div class="updated-by">by ${car.updatedBy}</div>` : '') :
                        '<div class="no-location">Ï£ºÏ∞® ÏúÑÏπòÍ∞Ä Îì±Î°ùÎêòÏßÄ ÏïäÏïòÏñ¥Ïöî</div>'
                    }
                </div>
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="showUpdateModal('${car.id}')">
                        ÏúÑÏπò ${car.location ? 'ÏàòÏ†ï' : 'Îì±Î°ù'}
                    </button>
                    <button class="btn btn-secondary" onclick="deleteCar('${car.id}')">
                        ÏÇ≠Ï†ú
                    </button>
                </div>
            `;
            carList.appendChild(carCard);
        });
    }

    // ÏãúÍ∞Ñ Í≥ÑÏÇ∞ Ïú†Ìã∏Î¶¨Ìã∞
    function getTimeAgo(timestamp) {
        const now = new Date();
        const updateTime = new Date(timestamp);
        const diffInMinutes = Math.floor((now - updateTime) / (1000 * 60));
        
        if (diffInMinutes < 1) return 'Î∞©Í∏à Ï†Ñ';
        if (diffInMinutes < 60) return `${diffInMinutes}Î∂Ñ Ï†Ñ`;
        if (diffInMinutes < 1440) return `${Math.floor(diffInMinutes / 60)}ÏãúÍ∞Ñ Ï†Ñ`;
        return `${Math.floor(diffInMinutes / 1440)}Ïùº Ï†Ñ`;
    }

    // Ïú†Ìã∏Î¶¨Ìã∞ Ìï®ÏàòÎì§
    function generateGroupCode() {
        return Math.random().toString(36).substr(2, 6).toUpperCase();
    }

    function generateUserId() {
        return Math.random().toString(36).substr(2, 9);
    }

    // Ï∞®Îüâ Ï∂îÍ∞Ä Î™®Îã¨ ÌëúÏãú
    function showAddCarModal() {
        document.getElementById('addCarModal').style.display = 'block';
        document.getElementById('carName').focus();
    }

    // Ï∞®Îüâ Ï∂îÍ∞Ä Î™®Îã¨ Ïà®ÍπÄ
    function hideAddCarModal() {
        document.getElementById('addCarModal').style.display = 'none';
        document.getElementById('carName').value = '';
    }

    // Ï∞®Îüâ Ï∂îÍ∞Ä
    function addCar() {
        const carName = document.getElementById('carName').value.trim();
        if (!carName) {
            showNotification('Ï∞®Îüâ Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî', 'error');
            return;
        }

        const newCar = {
            id: Date.now().toString(),
            name: carName,
            location: null,
            lastUpdated: null,
            updatedBy: null
        };

        cars.push(newCar);
        saveOnlineData();
        hideAddCarModal();
        showNotification('Ï∞®ÎüâÏù¥ Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§!');
    }

    // ÏúÑÏπò ÏóÖÎç∞Ïù¥Ìä∏ Î™®Îã¨ ÌëúÏãú
    function showUpdateModal(carId) {
        currentCarId = carId;
        const car = cars.find(c => c.id === carId);
        if (!car) return;

        document.getElementById('updateModalTitle').textContent = `${car.name} Ï£ºÏ∞® ÏúÑÏπò`;
        document.getElementById('updateLocationModal').style.display = 'block';
        
        if (car.location) {
            const [floor, section] = car.location.split(' - ');
            document.getElementById('floor').value = floor || '';
            document.getElementById('section').value = section || '';
        }
    }

    // ÏúÑÏπò ÏóÖÎç∞Ïù¥Ìä∏ Î™®Îã¨ Ïà®ÍπÄ
    function hideUpdateModal() {
        document.getElementById('updateLocationModal').style.display = 'none';
        document.getElementById('floor').value = '';
        document.getElementById('section').value = '';
        currentCarId = null;
    }

    // ÏúÑÏπò ÏóÖÎç∞Ïù¥Ìä∏
    function updateLocation() {
        if (!currentCarId) return;

        const floor = document.getElementById('floor').value;
        const section = document.getElementById('section').value.trim();

        if (!floor || !section) {
            showNotification('Ï∏µÍ≥º Íµ¨Ïó≠ÏùÑ Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî', 'error');
            return;
        }

        const car = cars.find(c => c.id === currentCarId);
        if (car) {
            car.location = `${floor} - ${section}`;
            car.lastUpdated = new Date().toISOString();
            car.updatedBy = userNickname;
            
            saveOnlineData();
            hideUpdateModal();
            showNotification('Ï£ºÏ∞® ÏúÑÏπòÍ∞Ä ÏóÖÎç∞Ïù¥Ìä∏ÎêòÏóàÏäµÎãàÎã§!');
        }
    }

    // Ï∞®Îüâ ÏÇ≠Ï†ú
    function deleteCar(carId) {
        if (confirm('Ï†ïÎßê Ïù¥ Ï∞®ÎüâÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†Ïñ¥Ïöî?')) {
            cars = cars.filter(c => c.id !== carId);
            saveOnlineData();
            showNotification('Ï∞®ÎüâÏù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§');
        }
    }

    // ÏïåÎ¶º ÌÜ†Í∏Ä
    function toggleNotification() {
        notificationEnabled = !notificationEnabled;
        document.getElementById('notificationToggle').classList.toggle('active', notificationEnabled);
        
        if (notificationEnabled) {
            if ('Notification' in window) {
                Notification.requestPermission().then((permission) => {
                    if (permission === 'granted') {
                        showNotification('Ïä§ÎßàÌä∏ ÏïåÎ¶ºÏù¥ ÌôúÏÑ±ÌôîÎêòÏóàÏäµÎãàÎã§! üì±');
                        scheduleNotifications();
                    } else {
                        notificationEnabled = false;
                        document.getElementById('notificationToggle').classList.remove('active');
                        showNotification('ÏïåÎ¶º Í∂åÌïúÏù¥ ÌïÑÏöîÌï©ÎãàÎã§', 'error');
                    }
                    saveLocalData();
                });
            } else {
                showNotification('Ïù¥ Î∏åÎùºÏö∞Ï†ÄÎäî ÏïåÎ¶ºÏùÑ ÏßÄÏõêÌïòÏßÄ ÏïäÏäµÎãàÎã§', 'error');
                notificationEnabled = false;
                document.getElementById('notificationToggle').classList.remove('active');
            }
        } else {
            showNotification('ÏïåÎ¶ºÏù¥ ÎπÑÌôúÏÑ±ÌôîÎêòÏóàÏäµÎãàÎã§');
        }
        saveLocalData();
    }

    function scheduleNotifications() {
        if (!notificationEnabled) return;

        const now = new Date();
        const scheduledTime = new Date();
        scheduledTime.setHours(21, 0, 0, 0);

        if (now > scheduledTime) {
            scheduledTime.setDate(scheduledTime.getDate() + 1);
        }

        const timeUntilNotification = scheduledTime - now;

        setTimeout(() => {
            if (notificationEnabled && Notification.permission === 'granted') {
                new Notification('üöó Ï£ºÏ∞® ÏúÑÏπò ÏóÖÎç∞Ïù¥Ìä∏ ÏïåÎ¶º', {
                    body: 'Ïò§Îäò Ï£ºÏ∞®Ìïú ÏúÑÏπòÎ•º ÏóÖÎç∞Ïù¥Ìä∏Ìï¥Ï£ºÏÑ∏Ïöî!',
                    vibrate: [200, 100, 200],
                    tag: 'parking-reminder'
                });
            }
            
            setTimeout(scheduleNotifications, 24 * 60 * 60 * 1000);
        }, timeUntilNotification);
    }

    function showNotification(message, type = 'success') {
        const notification = document.getElementById('notification');
        notification.textContent = message;
        notification.className = `notification ${type}`;
        notification.classList.add('show');

        setTimeout(() => {
            notification.classList.remove('show');
        }, 3000);
    }

    // Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑàÎì§
    window.addEventListener('click', function(event) {
        const addModal = document.getElementById('addCarModal');
        const updateModal = document.getElementById('updateLocationModal');
        
        if (event.target === addModal) {
            hideAddCarModal();
        }
        if (event.target === updateModal) {
            hideUpdateModal();
        }
    });

    document.addEventListener('keypress', function(event) {
        if (event.key === 'Enter') {
            const addModal = document.getElementById('addCarModal');
            const updateModal = document.getElementById('updateLocationModal');
            
            if (addModal.style.display === 'block') {
                addCar();
            } else if (updateModal.style.display === 'block') {
                updateLocation();
            }
        }
    });

    // ÏûêÎèô ÎåÄÎ¨∏Ïûê Î≥ÄÌôò
    document.getElementById('joinCode').addEventListener('input', function(e) {
        e.target.value = e.target.value.toUpperCase();
    });
</script>
```

</body>
</html>
